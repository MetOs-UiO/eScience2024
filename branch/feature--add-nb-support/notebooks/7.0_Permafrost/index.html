<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Permafrost Exercise &mdash; eScience-2024  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx_rtd_theme_ext_color_contrast.css?v=8e8ea19f" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=e4194741" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=187304be"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Test for nbsphinx" href="../nbsphinx_test/" />
    <link rel="prev" title="Example Notebooks" href="../" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../" class="icon icon-home">
            eScience-2024
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../feide/">Jupyterhub access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basics/">Jupyterhub basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../git_integration/">Using git on the jupyterhub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../">Example Notebooks</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Permafrost Exercise</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#permafrost-fraction-as-a-function-of-mean-annual-air-temperature-maat">Permafrost fraction as a function of mean annual air temperature (MAAT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#permafrost-fraction-from-noresm2-mm">Permafrost Fraction from NorESM2-MM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nbsphinx_test/">Test for nbsphinx</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license/">Credit</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">eScience-2024</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../">Example Notebooks</a></li>
      <li class="breadcrumb-item active">Permafrost Exercise</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/MetOs-UiO/eScience2024/blob/main/docs/notebooks/7.0_Permafrost.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="permafrost-exercise">
<h1>Permafrost Exercise<a class="headerlink" href="#permafrost-exercise" title="Link to this heading"></a></h1>
<section id="permafrost-fraction-as-a-function-of-mean-annual-air-temperature-maat">
<h2>Permafrost fraction as a function of mean annual air temperature (MAAT)<a class="headerlink" href="#permafrost-fraction-as-a-function-of-mean-annual-air-temperature-maat" title="Link to this heading"></a></h2>
<p>Despite progress in process-based modelling on local and regional scales, a lack of data availability and model limitations cause permafrost still being poorly simulated in global climate models.</p>
<p>Large-scale permafrost thaw can be projected using an observation-based relationship (see below) between permafrost probability and mean annual air temperatue (MAAT), statistically accounting for other determining factors such as topography, soil properties, snow and hydrology. Over large spatial scales the probability translates to permafrost fraction.</p>
<p>In this exercise, we will apply this relationship to climate model output to explore permafrost occurence in historical periods and in future climate scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import python packages</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cf</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># constants</span>
<span class="n">fp</span> <span class="o">=</span> <span class="mf">273.15</span> <span class="c1"># freezing point in K</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Relationship Permafrost Fraction and MAAT (Gruber 2012)</span>
<span class="k">def</span> <span class="nf">PF</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="n">PF</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span> <span class="p">(</span><span class="n">MAAT</span><span class="o">+</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">PF</span>
    
<span class="c1"># from Chadburn et al. (2017)</span>
<span class="n">mu_chad</span> <span class="o">=</span> <span class="mf">4.38</span>
<span class="n">sigma_chad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.59</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> 
<span class="n">mu_max_chad</span> <span class="o">=</span> <span class="mf">3.05</span>
<span class="n">sigma_max_chad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.97</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> 
<span class="n">mu_min_chad</span> <span class="o">=</span> <span class="mf">6.53</span>
<span class="n">sigma_min_chad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.57</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inspect relationship</span>
<span class="n">MAAT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">18</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>

<span class="n">mylinewidth</span><span class="o">=</span><span class="mi">1</span>
<span class="n">mylinestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>

<span class="n">mycolor1</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span> <span class="n">PF</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span><span class="n">mu_chad</span><span class="p">,</span> <span class="n">sigma_chad</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">mycolor1</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">mylinewidth</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;norm variant&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span> <span class="n">PF</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span><span class="n">mu_min_chad</span><span class="p">,</span> <span class="n">sigma_min_chad</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">mylinewidth</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">mylinestyle</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;warm variant&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span> <span class="n">PF</span><span class="p">(</span><span class="n">MAAT</span><span class="p">,</span><span class="n">mu_max_chad</span><span class="p">,</span> <span class="n">sigma_max_chad</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">mylinewidth</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">mylinestyle</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;cold variant&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mean annual air temperature [deg C]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Permafrost fraction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39; &#39;)
</pre></div>
</div>
<img alt="../../_images/32d9206865f905faa5b395a11270f57fef34c225af05a2866201030e77f08f85.png" src="../../_images/32d9206865f905faa5b395a11270f57fef34c225af05a2866201030e77f08f85.png" />
</div>
</div>
</section>
<section id="permafrost-fraction-from-noresm2-mm">
<h2>Permafrost Fraction from NorESM2-MM<a class="headerlink" href="#permafrost-fraction-from-noresm2-mm" title="Link to this heading"></a></h2>
<p><strong>Task: Read in the monthly surface temperature data of NorESM2-MM for the historical period 1960-1990 (choose ensemble member r1i1p1f1). Combine the necessary files by coordinates.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read in data</span>
<span class="c1"># NorESM</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/mnt/tacco-ns1004k-cmroot/NorESM2-MM/&#39;</span> <span class="c1"># NorESM2-MM has a res of ~1deg</span>
<span class="n">files</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;historical/*/*tas_Amon*r1i1p1f1*&quot;</span><span class="p">))</span>
<span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">tas_Amon</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Task: Calculate the mean surface air temperature in degrees Celsius during this period for each gridcell</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tas_mean_1960_1990</span> <span class="o">=</span> 
</pre></div>
</div>
</div>
</div>
<p><strong>Task: Calculate the permafrost fraction</strong> <br>
Apply the function PF(MAAT, mu, sigma) to the mean surface air temperatures. <br>
Use $\mu =\mu_{chad}$ and $\sigma= \sigma_{chad}$ as parameters for the function. <br>
Hint: You can update the name of your newly created variable using variablename.rename(‘newname’).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PF_cont</span> <span class="o">=</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Task: Display the permafrost fraction</strong> <br>
Plot the permafrost fraction of the circumarctic region from 24 to 90 deg North as a North Polar Stereo projection ( projection=ccrs.NorthPolarStereo() ). <br>
You can change the extend of the map using &lt;&lt; ax.set_extent([lon_min, lon_max, lat_min, Lat_max], ccrs.PlateCarree() &gt;&gt; <br></p>
<p><strong>Task: Mask out the ocean gridcells</strong><br>
Use the lsurface tile land fraction (sftlf) output of NorESM2-MM (below) to categorize all gridcells with with $sftlf&gt;0.5$ as land landsurface and display only these.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># land area coverage</span>
<span class="n">files</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;historical/*/*sftlf*r1i1p1f1*&quot;</span><span class="p">))</span>
<span class="n">sftlf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
<span class="n">sftlf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># masked map</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Task: Categorize the different permafrost zones</strong><br>
Apply the following mask to the obtained permafrost fraction.<br>
0-0.1 : no or isolated permafrost <br>
0.1-0.5: sporadic permafrost <br>
0.5-0.9: discontinuous permafrost <br>
0.9-1 : continuous permafrost<br></p>
<p>Display the output and discuss it with your neighbour. What is surpring to you? Can you think of limitations of this method and and it’s input data from NorESM2-MM? Where can we not trust the map?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IPA permafrost masks none/isolated - sporadic -discontinuous - continuous </span>
<span class="n">PF_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">PF_cont</span> <span class="o">&lt;=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
<span class="n">PF_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">PF_cont</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PF_mask</span><span class="p">)</span>
<span class="n">PF_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">PF_cont</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PF_mask</span><span class="p">)</span>
<span class="n">PF_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">PF_cont</span> <span class="o">&gt;</span> <span class="mf">0.9</span> <span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">PF_mask</span><span class="p">)</span>
<span class="n">PF_mask</span> <span class="o">=</span> <span class="n">PF_mask</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;permafrost zones&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Task: How will the permafrost thaw under SSP585?</strong> <br>
Create the same map with the SSP585 output of NorESM for the period of 2240-2270. <br>
Where does the permafrost thaw? Compare your results to the soil carbon content map from the lecture. Discuss uncertainties.<br></p>
<p><strong>Bonustask: Look into different climate scenarios / models</strong></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../" class="btn btn-neutral float-left" title="Example Notebooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../nbsphinx_test/" class="btn btn-neutral float-right" title="Test for nbsphinx" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, MetOs, UiO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>